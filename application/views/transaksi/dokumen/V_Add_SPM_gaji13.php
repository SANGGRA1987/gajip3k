<form id="fm" method="post" novalidate style="margin:0;padding:10px 10px" enctype="multipart/form-data">
    <div class="row">
        <div class="col-md-6">
             <div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>No. SPM</label></div>
                    <div class="col-sm-3"><input id="no_spm" name="no_spm" type="text" class="easyui-textbox" style="width:50%;" ></div>
					<div class="col-sm-6"><input id="no_spm1" name="no_spm1" type="text" class="easyui-textbox" style="width:50%; text-align: left;" readonly="true" disabled="disabled"></div>
                </div>
            </div>	
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Satkerja</label></div>
                    <div class="col-sm-3"><input id="satkerja" name="satkerja" type="text" class="easyui-textbox" style="width:80%;"></div>
					<div class="col-sm-6"><input id="nm_satkerja" name="nm_satkerja" type="text" class="easyui-textbox" style="width:100%;" readonly="true"></div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Para Pegawai</label></div>
                    <div class="col-sm-2">
                        <input id="para_pegawai" name="para_pegawai" type="text" class="easyui-textbox" style="width:80%;">
                    </div>
                </div>
            </div>		
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Nomor SPD</label></div>
                    <div class="col-sm-9">
                        <input id="no_spd" name="no_spd" type="text" class="easyui-textbox" style="width:100%;text-align:left;">
                    </div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>No. Rekening</label></div>
                    <div class="col-sm-9">
                        <input id="no_rekening" name="no_rekening" type="text" class="easyui-textbox" style="width:100%;text-align:left;">
                    </div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>NPWP</label></div>
                    <div class="col-sm-9">
                        <input id="npwp" name="npwp" type="text" class="easyui-textbox" style="width:100%;text-align:left;">
                    </div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Bayar Kepada</label></div>
                    <div class="col-sm-9">
                        <textarea id="bayar_kepada" name="bayar_kepada" class="form-control" style="width: 100%" disabled="true"></textarea>
                    </div>
                </div>
            </div>			 			          
        </div>
		<div class="col-md-6">
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Tanggal</label></div>
                    <div class="col-sm-6">
                        <div class="input-group" style="width:80%;">
                          <input id="tanggal" name="tanggal" type="text" class="form-control" style="width:100%;" >
                           <span class="input-group-addon" > <i class="glyphicon glyphicon-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>
			<div hidden style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Golongan</label></div>
                    <div class="col-sm-3"><input id="golongan1" name="golongan1" type="text" class="easyui-textbox" style="width:50%;"></div>
					<div class="col-sm-2">S/D</div>
					<div class="col-sm-3"><span id="golongan2" name="golongan2" type="text" class="easyui-textbox" style="width:50%; text-align: center;"><span></div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>J. Belanja</label></div>
                    <div class="col-sm-2">
                        <input id="j_belanja" name="j_belanja" type="text" class="easyui-textbox" style="width:80%;">
                    </div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Nomor SPP</label></div>
                    <div class="col-sm-9">
                        <input id="no_spp" name="no_spp" type="text" class="easyui-textbox" style="width:100%;text-align:left;">
                    </div>
                </div>
            </div>
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Bank</label></div>
                    <div class="col-sm-9">
                        <input id="bank" name="bank" type="text" class="easyui-textbox" style="width:100%;text-align:left;">
                    </div>
                </div>
            </div>
			<div style="margin-bottom:10px" hidden="true">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"></div>
                    <div class="col-sm-9"></div>
                </div>
            </div> 
			<div style="margin-bottom:10px">
                <div class="col-sm-12" style="padding-bottom: 10px;">
                    <div class="col-sm-3" style="padding-top: 3px;"><label>Untuk</label></div>
                    <div class="col-sm-9">
					 	<textarea id="untuk" name="untuk" class="form-control" style="width:100%" disabled="true"></textarea>
                    </div>
                </div>
            </div>
		</div>
    </div>
</form>

<div style="padding-bottom: 20px;">
    <button type="button" class="btn btn-primary btn-lg btn-block" style="width:100%" onClick="javascript:savedetail();"><b>PROSES</b></button>
</div>

<table id="dg" name="dg"><h4>Detail Rekening</h4></table>
<div class="row" id="sum_show">
    <div class="col-md-3 text-right">
        <h4><span>Total Rekening: </span></h4>
    </div>
    <div class="col-md-7 text-right">
        <h4><span id="total_s1"></span></h4>
    </div>
</div>
<table id="dg1" name="dg1"><h4>Detail Rekening Potongan</h4></table>
<div class="row" id="sum_show">
    <div class="col-md-3 text-right">
        <h4><span>Total Potongan: </span></h4>
    </div>
	<div class="col-md-7 text-right">
        <h4><span id="total_ss"></span></h4>
    </div>
</div>

<div style="padding-top: 10px;" class="row">
    <div class="col-sm-2 col-sm-offset-4">
        <button type="button" class="btn btn-default btn-lg btn-block" onClick="javascript:saveData()">Simpan</button>
    </div>
    <div class="col-sm-2 col-sm-offset">
        <button type="button" class="btn btn-default btn-lg btn-block" onClick="javascript:back();">Kembali</button>
    </div>
	    <div id="progressFile" class="easyui-progressbar" style="width:50%;" hidden="true"></div>
</div>


<script type="text/javascript" src="<?php echo site_url('assets/easyui/numberFormat.js'); ?>"></script>
<script type="text/javascript" src="<?php echo site_url('assets/easyui/autoCurrency.js') ?>"></script>
<script type="text/javascript">

$(document).ready(function() {
           $('#satkerja').combogrid({
				panelWidth:700,  
				idField:'satkerja',  
				textField:'satkerja',  
				url:'<?php echo base_url(); ?>transaksi/C_SPM_gaji13/get_satker', 
				mode:'remote',
				columns:[[  
				   {field:'satkerja',title:'Kode',width:100,align:'center'},  
				   {field:'nm_satkerja',title:'Nama Satker',width:600}    
				]],
				onSelect:function(rowIndex,rowData){
				   satkerja = rowData.satkerja;
				   nm_satkerja = rowData.nm_satkerja;
				   $("#nm_satkerja").textbox('setValue',nm_satkerja);
				}
        	});
			
			$('#golongan1').combogrid({
				panelWidth:400,  
				idField:'id',  
				textField:'id',  
				url:'<?php echo base_url(); ?>transaksi/C_SPM_gaji13/golongan1', 
				mode:'remote',
				columns:[[  
				   {field:'id',title:'Kode',width:100,align:'center'},  
				   {field:'nm_golongan',title:'Nama',width:300}    
				]],
				onSelect:function(rowIndex,rowData){
				   id1 = rowData.id;
				   nm_golongan1 = rowData.nm_golongan;
				}
        	});
			
			$('#golongan2').combogrid({
				panelWidth:400,  
				idField:'id',  
				textField:'id',  
				url:'<?php echo base_url(); ?>transaksi/C_SPM_gaji13/golongan1', 
				mode:'remote',
				columns:[[  
				   {field:'id',title:'Kode',width:100,align:'center'},  
				   {field:'nm_golongan',title:'Nama',width:300}    
				]],
				onSelect:function(rowIndex,rowData){
				   id2 = rowData.id;
				   nm_golongan2 = rowData.nm_golongan;
				}
        	});
			
			$('#para_pegawai').combobox({           
				valueField:'kode',  
				textField:'kode',
				width:50,
				data:[{kode:'Y'},{kode:'T'}]
        	});
			
			$('#j_belanja').combobox({           
				valueField:'kode',  
				textField:'kode',
				width:50,
				data:[{kode:'1'},{kode:'2'}]
        	});
			
			$('#tanggal').datepicker({
              format: 'dd-mm-yyyy',
              autoclose: true
        	});

        	//$('#tanggal').val(getToday());
		
		
        $('#dg').datagrid({
            idField:'id',
            width: '1000',
            height: '400',
            nowrap: true,
        pagination: true,
        rownumbers: true,
        fitColumns: true,
        singleSelect: true,
        remoteSort: true,  
        showFooter: true,           
            loadMsg: 'Tunggu Sebentar ... !',            
            columns:[[
                {field:'kd_rek5', title:'Rekening', width:50, halign:"center",align:"left"},
				{field:'nm_rek5', title:'Nama Rekening', width:150, halign:"center",align:"left"},
				{field:'nilai', title:'Jumlah', width:50, halign:"center",align:"right"},
				{field:'nilai1', title:'Jumlah', width:50, halign:"center",align:"right",hidden:'true'}
            ]],
            onEndEdit:function(index,row){
            var ed = $(this).datagrid('getEditor', {
                index: index,
                field: 'no_spm'
                });
            },
            onBeforeEdit:function(index,row){
                row.editing = true;
                $(this).datagrid('refreshRow', index);
            },
            onAfterEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            },
            onCancelEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            }
        });
		
		$('#dg1').datagrid({
            idField:'id',
            width: '1000',
            height: '400',
            nowrap: true,
        pagination: true,
        rownumbers: true,
        fitColumns: true,
        singleSelect: true,
        remoteSort: true,  
        showFooter: true,           
            loadMsg: 'Tunggu Sebentar ... !',            
            columns:[[
				{field:'kd_rek5_pot', title:'Potongan', width:50, halign:"center",align:"left"},
				{field:'nm_rek5_pot', title:'Nama Potongan', width:150, halign:"center",align:"left"},
				{field:'nilai_pot', title:'Jumlah', width:50, halign:"center",align:"right"},
				{field:'nilai_pot1', title:'Jumlah', width:50, halign:"center",align:"right",hidden:'true'}
            ]],
            onEndEdit:function(index,row){
            var ed = $(this).datagrid('getEditor', {
                index: index,
                field: 'no_spm'
                });
            },
            onBeforeEdit:function(index,row){
                row.editing = true;
                $(this).datagrid('refreshRow', index);
            },
            onAfterEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            },
            onCancelEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            }
        });
		
    });
	
	function load_detail(no_spm,kd_skpd) {
		var kode1 = kd_skpd ;
		var kode = kode1;
        $('#dg').datagrid({
            url:'<?php echo site_url('transaksi/C_SPM_gaji13/load_detail') ?>',
            idField:'id',
            width: '1000',
            height: '400',
            nowrap: true,
        pagination: true,
        rownumbers: true,
        fitColumns: true,
        singleSelect: true,
        remoteSort: true,  
        queryParams:{no: no_spm, kode: kd_skpd},
            loadMsg: 'Tunggu Sebentar ... !',
            columns:[[
                {field:'kd_rek5', title:'Rekening', width:50, halign:"center",align:"left"},
				{field:'nm_rek5', title:'Nama Rekening', width:150, halign:"center",align:"left"},
				{field:'nilai', title:'Jumlah', width:50, halign:"center",align:"right"},
				{field:'nilai1', title:'Jumlah', width:50, halign:"center",align:"right",hidden:'true'}	
            ]],
            onEndEdit:function(index,row){
            var ed = $(this).datagrid('getEditor', {
                index: index,
                field: 'no_spm'
                });
            },
            onBeforeEdit:function(index,row){
                row.editing = true;
                $(this).datagrid('refreshRow', index);
            },
            onAfterEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            },
            onCancelEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            }
        });
        
    }
	
	function load_detail_pot(no_spm,kd_skpd) {
		var kode1 = kd_skpd ;
		var kode = kode1;
        $('#dg1').datagrid({
            url:'<?php echo site_url('transaksi/C_SPM_gaji13/load_detail_pot') ?>',
            idField:'id',
            width: '1000',
            height: '250',
            nowrap: true,
        pagination: true,
        rownumbers: true,
        fitColumns: true,
        singleSelect: true,
        remoteSort: true,  
        queryParams:{no: no_spm, kode: kd_skpd},
            loadMsg: 'Tunggu Sebentar ... !',
            columns:[[
				{field:'kd_rek5_pot', title:'Potongan', width:50, halign:"center",align:"left"},
				{field:'nm_rek5_pot', title:'Nama Potongan', width:150, halign:"center",align:"left"},
				{field:'nilai_pot', title:'Jumlah', width:50, halign:"center",align:"right"},
				{field:'nilai_pot1', title:'Jumlah', width:50, halign:"center",align:"right",hidden:'true'}		
            ]],
            onEndEdit:function(index,row){
            var ed = $(this).datagrid('getEditor', {
                index: index,
                field: 'no_spm'
                });
            },
            onBeforeEdit:function(index,row){
                row.editing = true;
                $(this).datagrid('refreshRow', index);
            },
            onAfterEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            },
            onCancelEdit:function(index,row){
                row.editing = false;
                $(this).datagrid('refreshRow', index);
            }
        });
        
    }
	
	function get_total(no_spm,kd_skpd){
			$.ajax({
                    type: "POST",
                    url: '<?php echo base_url(); ?>transaksi/C_SPM_gaji13/ambil_total',
                    dataType:"json",
                    data:({kd_skpd:kd_skpd,no_spm:no_spm}),
                    success:function(data){
							$.each(data,function(i,n){ 
								ctotal_rek  = n['total_rekx']; 
								ctotal_pot  = n['total_potx'];
																
								$("#total_s1").text(number_format(ctotal_rek,2,'.',','));
								$("#total_ss").text(number_format(ctotal_pot,2,'.',','));							  
						  	});	
														
                    }					
                });
	}
	
		
	function savedetail(){  
		var satkerja     = $('#satkerja').combogrid('getValue');
		var gol1     	= $('#golongan1').combogrid('getValue');
		var gol2     	= $('#golongan2').combogrid('getValue');
		if(satkerja==''){
			iziToast.error({
				title: 'Error',
				message: 'Satuan Kerja Tidak boleh Kosong',
			});
		}
		var ctanggal   = $('#tanggal').val();
		var p_ctanggal = ctanggal.length;
		var cthn = ctanggal.substr(6,4);
		var cbln = ctanggal.substr(3,2);
		
		var bln = 0;
		if(cbln=='01'){
			nm_bln = 'Januari';
			bln = 1;
		}else if(cbln=='02'){
			nm_bln = 'Februari';
			bln = 2;
		}else if(cbln=='03'){
			nm_bln = 'Maret';
			bln = 3;
		}else if(cbln=='04'){
			nm_bln = 'April';
			bln = 4;
		}else if(cbln=='05'){
			nm_bln = 'Mei';
			bln = 5;
		}else if(cbln=='06'){
			nm_bln = 'Juni';
			bln = 6;
		}else if(cbln=='07'){
			nm_bln = 'Juli';
			bln = 7;
		}else if(cbln=='08'){
			nm_bln = 'Agustus';
			bln = 8;
		}else if(cbln=='09'){
			nm_bln = 'September';
			bln = 9;
		}else if(cbln=='10'){
			nm_bln = 'Oktober';
			bln = 10;
		}else if(cbln=='11'){
			nm_bln = 'November';
			bln = 11;
		}else if(cbln=='12'){
			nm_bln = 'Desember';
			bln = 12;
		}
		
			$.ajax({
                    type: "POST",
                    url: '<?php echo base_url(); ?>transaksi/C_SPM_gaji13/untuk',
                    dataType:"json",
                    data:({satkerja:satkerja,gol1:gol1,gol2:gol2}),
                    success:function(data){
                        var cjumpeg = data.total;
						var cjumnikah = data.total2;
						var cjumanak = data.total3;
						var cjiwa = Number(cjumpeg)+Number(cjumnikah)+Number(cjumanak);
						var cuntuk = 'Untuk Pembayaran Gaji Bulan gaji ke 13 '+cthn+' bagi '+cjumpeg+' Pegawai/ '+cjiwa+' Jiwa ('+cjumpeg+','+cjumnikah+','+cjumanak+') = '+cjiwa+' jiwa.  Pada '+nm_satkerja+' Sesuai SPP Nomor : terlampir. ';   
                        $("#untuk").val(cuntuk);
						var cbayar_kepada = 'Harap membayar kepada para pegawai '+nm_satkerja+' se-Kabupaten Berau yang mempunyai rekening pada Bank Kalbar.'; 
						$("#bayar_kepada").val(cbayar_kepada);						
                    }
                });
				var total        = 0;
				var total_pot    = 0;
				$.ajax({
                    type: "POST",
                    url: '<?php echo base_url(); ?>transaksi/C_SPM_gaji13/rekening',
                    dataType:"json",
                    data:({satkerja:satkerja,gol1:gol1,gol2:gol2}),
                    success:function(data){
							$.each(data,function(i,n){ 	
								xkdrek5  = n['kdrek5'];
								xnmrek5  = n['nmrek5'];
								xnilai   = n['nilai1']; 
								xnilaix  = n['nilaix']; 
								xkdrek5_pot  = n['kdrek5_pot'];
								xnmrek5_pot  = n['nmrek5_pot'];
								xnilai_pot   = n['nilai1_pot']; 
								xnilaix_pot  = n['nilaix_pot'];
							    
								var total_rekening = angka(xnilaix);
							    total = total + total_rekening;
								var total_potongan = angka(xnilaix_pot);
							    total_pot = total_pot + total_potongan;
								
								$("#total_s1").text(number_format(total,2,'.',','));
								$("#total_ss").text(number_format(total_pot,2,'.',','));
							  
							  $('#dg').datagrid('appendRow',{kd_rek5:xkdrek5,nm_rek5:xnmrek5,nilai:xnilai,nilai1:xnilaix});
							  $('#dg1').datagrid('appendRow',{kd_rek5_pot:xkdrek5_pot,nm_rek5_pot:xnmrek5_pot,nilai_pot:xnilai_pot,nilai_pot1:xnilaix_pot}); 
						  	});	
														
                    }					
                });
    } 
	
	window.onload = function(){
        var status  = localStorage.getItem('status');
        if (status == 'detail') {	
		var no_spm 		= localStorage.getItem('no_spm');
		var no 			= no_spm.substr(0,4);
		var no1 		= no_spm.substr(4,8);
		var tgl_spm 	= localStorage.getItem('tgl_spm');
		var keperluan 	= localStorage.getItem('keperluan');
		var nilai 		= localStorage.getItem('nilai');
		var no_spp 		= localStorage.getItem('no_spp');
		var no_spd 		= localStorage.getItem('no_spd');
		var no_rek 		= localStorage.getItem('no_rek');
		var npwp 		= localStorage.getItem('npwp');
		var kd_skpd 	= localStorage.getItem('kd_skpd');
		var kode 		= kd_skpd.substr(0,7);
		var nm_skpd 	= localStorage.getItem('nm_skpd');
		var bayar_kepada = localStorage.getItem('bayar_kepada');
				
		$("#no_spm").textbox('setValue',no);
		$("#no_spm1").textbox('setValue',no1);
		$("#tanggal").val(tgl_spm);
		$("#para_pegawai").textbox('setValue','Y');
		$("#golongan1").textbox('setValue','1');
		$("#golongan2").textbox('setValue','17');
		$("#j_belanja").textbox('setValue','2');
		$("#untuk").val(keperluan);	
		$("#no_spp").textbox('setValue',no_spp);
		$("#no_spd").textbox('setValue',no_spd);
		$("#no_rekening").textbox('setValue',no_rek);
		$("#npwp").textbox('setValue',npwp);
		$("#satkerja").textbox('setValue',kode);
		$("#nm_satkerja").textbox('setValue',nm_skpd);
		$("#bayar_kepada").val(bayar_kepada);	
		
		load_detail(no_spm,kd_skpd);
		load_detail_pot(no_spm,kd_skpd);
		get_total(no_spm,kd_skpd);
				
        } else {		
		$("#no_spm1").textbox('setValue','.GJ13/2021');
		$("#para_pegawai").textbox('setValue','Y');
		$("#golongan1").textbox('setValue','1');
		$("#golongan2").textbox('setValue','17');
		$("#j_belanja").textbox('setValue','2');
		}
    }

    function back() {
        localStorage.clear();
        window.location.href = "<?php echo base_url(); ?>transaksi/C_SPM_gaji13";
    }

    function getToday() {
      var d = new Date();
      var month = d.getMonth()+1;
      var day = d.getDate();
      var output = ((''+day).length<2 ? '0' : '') + day + '-' +
                   ((''+month).length<2 ? '0' : '') + month + '-' +
                   d.getFullYear();
      return output;
    }

    function tanggal_ind(tgl){
        var tahun   =  tgl.substr(0,4);
        var bulan   = tgl.substr(5,2);
        var tanggal =  tgl.substr(8,2);
        var jadi = tanggal+'-'+bulan+'-'+tahun;
        return jadi;  
    }
	
	function saveData(){
        var no_spm     = $('#no_spm').val();
		var no_spm1    = $('#no_spm1').val();
		var nomor_spm  = no_spm+no_spm1;
		var nomor_sp2d  = no_spm + '/SP2D/2021';
		var satkerja   = $('#satkerja').val();
		var kd_skpd    = satkerja;
		var kd_giat    = satkerja + '.TL.01';	
		var nm_giat    = 'Belanja Pegawai';
		var kd_program = satkerja + '.TL';	
		var nm_program = 'BELANJA TIDAK LANGSUNG';
		var nm_satkerja= $('#nm_satkerja').val();
		var no_spd     = $('#no_spd').val();
		var no_rekening= $('#no_rekening').val();
		var npwp     	= $('#npwp').val();
		var bayar_kepada= $('#bayar_kepada').val();
		var tanggal     = $('#tanggal').val();
		var no_spp      = $('#no_spp').val();
		var bank        = $('#bank').val();
		var untuk       = $('#untuk').val();		
        var total       = angka($('#total_s1').text());
		var total_pot   = angka($('#total_ss').text());
        var status      = localStorage.getItem('status');
        var data1       = $('#dg').datagrid('getRows');
		var data2       = $('#dg1').datagrid('getRows');
		var ctanggal   = $('#tanggal').val();
		var p_ctanggal = ctanggal.length;
		var cbln = ctanggal.substr(3,2);
		
		if(nomor_spm==''){
			iziToast.error({
				title: 'Error',
				message: 'Nomor SPM Tidak boleh Kosong',
			});
			return
		}
		if(satkerja==''){
			iziToast.error({
				title: 'Error',
				message: 'Satkerja Tidak boleh Kosong',
			});
			return
		}
		if(no_spd==''){
			iziToast.error({
				title: 'Error',
				message: 'Nomor SPD Tidak boleh Kosong',
			});
			return
		}
		if(no_spp==''){
			iziToast.error({
				title: 'Error',
				message: 'Nomor SPP Tidak boleh Kosong',
			});
			return
		}
		if(no_rekening==''){
			iziToast.error({
				title: 'Error',
				message: 'Nomor Rekening Tidak boleh Kosong',
			});
			return
		}
		if(npwp==''){
			iziToast.error({
				title: 'Error',
				message: 'NPWP Tidak boleh Kosong',
			});
			return
		}
		if(ctanggal==''){
			iziToast.error({
				title: 'Error',
				message: 'Tanggal Tidak boleh Kosong',
			});
			return
		}
		
		if(cbln=='01'){
			bln = 1;
		}else if(cbln=='02'){
			bln = 2;
		}else if(cbln=='03'){
			bln = 3;
		}else if(cbln=='04'){
			bln = 4;
		}else if(cbln=='05'){
			bln = 5;
		}else if(cbln=='06'){
			bln = 6;
		}else if(cbln=='07'){
			bln = 7;
		}else if(cbln=='08'){
			bln = 8;
		}else if(cbln=='09'){
			bln = 9;
		}else if(cbln=='10'){
			bln = 10;
		}else if(cbln=='11'){
			bln = 11;
		}else if(cbln=='12'){
			bln = 12;
		}
		
        
        $.post('<?php echo base_url(); ?>transaksi/C_SPM_gaji13/saveData', {detail: JSON.stringify(data1),detail2: JSON.stringify(data2),no_spm:no_spm,no_spm1:no_spm1,satkerja:satkerja,nm_satkerja:nm_satkerja,no_spd:no_spd,no_rekening:no_rekening,npwp:npwp,bayar_kepada:bayar_kepada,tanggal:tanggal,no_spp:no_spp,bank:bank,untuk:untuk,total:total,total_pot:total_pot,status:status,nomor_spm:nomor_spm,nomor_sp2d:nomor_sp2d,kd_skpd:kd_skpd,kd_giat:kd_giat,nm_giat:nm_giat,bln:bln,kd_program:kd_program,nm_program:nm_program}, 
		function(result) {
        if (result.notif){
                iziToast.success({
                    title: 'OK',
                    message: result.message,
                });
            } else {
                iziToast.error({
                    title: 'Error',
                    message: result.message,
                });
            }
        }, "json");

        if (status=='tambah'){
            kosong_isi();
        }
    }
	function kosong_isi(){
			$("#no_spm").textbox('setValue','');
            //$('#tanggal').val(getToday());
            $("#satkerja").combogrid("setValue", '');
			$("#nm_satkerja").textbox('setValue','');
			$("#no_spd").textbox('setValue','');
			$("#no_rekening").textbox('setValue','');
			$("#npwp").textbox('setValue','');
			$("#bayar_kepada").textbox('setValue','');
			$("#no_spp").textbox('setValue','');
			$("#bank").textbox('setValue','');
			$("#untuk").textbox('setValue','');
            $("#total_s1").text('');
			$("#total_ss").text('');			
            $('#dg').datagrid('loadData', {"rows":[]});
			$('#dg1').datagrid('loadData', {"rows":[]});
    }

  

    
    
</script>